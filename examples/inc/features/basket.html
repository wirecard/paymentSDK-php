<!DOCTYPE html><html lang="en"><head><title>examples/inc/features/basket</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../../"><meta name="groc-document-path" content="examples/inc/features/basket"><meta name="groc-project-path" content="examples/inc/features/basket.php"><link rel="stylesheet" type="text/css" media="all" href="../../../assets/style.css"><script type="text/javascript" src="../../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">examples/inc/features/basket.php</div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-preprocessor">&lt;?php</span>
<span class="hljs-comment">/**
 * Shop System SDK:
 * - Terms of Use can be found under:
 * https://github.com/wirecard/paymentSDK-php/blob/master/_TERMS_OF_USE
 * - License can be found under:
 * https://github.com/wirecard/paymentSDK-php/blob/master/LICENSE
 */</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h1 id="basket-data">Basket data</h1></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The data, which items were purchased is required for some payment methods like RatePAY invoice / installment.
At some payment methods like PayPal this information can be displayed on the payment processing page.</p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="required-objects">Required objects</h2></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>To include the necessary files, we use the composer for PSR-4 autoloading.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">require</span> <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">'/../../../vendor/autoload.php'</span>;
<span class="hljs-keyword">require</span> <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">'/../common.php'</span>;
<span class="hljs-keyword">require</span> <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">'/../../configuration/config.php'</span>;
<span class="hljs-keyword">require</span> <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">'/../header.php'</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Wirecard</span>\<span class="hljs-title">PaymentSdk</span>\<span class="hljs-title">Entity</span>\<span class="hljs-title">Amount</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Wirecard</span>\<span class="hljs-title">PaymentSdk</span>\<span class="hljs-title">Entity</span>\<span class="hljs-title">Redirect</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Wirecard</span>\<span class="hljs-title">PaymentSdk</span>\<span class="hljs-title">Entity</span>\<span class="hljs-title">Item</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Wirecard</span>\<span class="hljs-title">PaymentSdk</span>\<span class="hljs-title">Entity</span>\<span class="hljs-title">Basket</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Wirecard</span>\<span class="hljs-title">PaymentSdk</span>\<span class="hljs-title">Response</span>\<span class="hljs-title">FailureResponse</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Wirecard</span>\<span class="hljs-title">PaymentSdk</span>\<span class="hljs-title">Response</span>\<span class="hljs-title">InteractionResponse</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Wirecard</span>\<span class="hljs-title">PaymentSdk</span>\<span class="hljs-title">Transaction</span>\<span class="hljs-title">PayPalTransaction</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Wirecard</span>\<span class="hljs-title">PaymentSdk</span>\<span class="hljs-title">TransactionService</span>;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h3 id="transaction-related-objects">Transaction related objects</h3></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Set redirect URLs for success, cancel and failure.
From payment page you will be redirected to:
Success URL when the payment is approved.
Cancel URL when the user cancels the transaction on payment page.
Failure URL when payment is not approved or the data are missing or incorrect</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$redirectUrls</span> = <span class="hljs-keyword">new</span> Redirect(
    getUrl(<span class="hljs-string">'../PayPal/return.php?status=success'</span>),
    getUrl(<span class="hljs-string">'../PayPal/return.php?status=cancel'</span>),
    getUrl(<span class="hljs-string">'../PayPal/return.php?status=failure'</span>)
);
<span class="hljs-variable">$notificationUrl</span> = getUrl(<span class="hljs-string">'../PayPal/notify.php'</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h3 id="basket-items">Basket items</h3>
<p>A Basket contains one or more items.</p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>For each item you have to set some properties as described here.
The name, the price and the quantity are required,
the article number, the description, the tax rate and the tax amount are optional.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$item1</span> = <span class="hljs-keyword">new</span> Item(<span class="hljs-string">'Item 1'</span>, <span class="hljs-keyword">new</span> Amount(<span class="hljs-number">2.59</span>, <span class="hljs-string">'EUR'</span>), <span class="hljs-number">1</span>);
<span class="hljs-variable">$item1</span>-&gt;setArticleNumber(<span class="hljs-string">'A1'</span>);
<span class="hljs-variable">$item1</span>-&gt;setDescription(<span class="hljs-string">'My first item'</span>);
<span class="hljs-variable">$item1</span>-&gt;setTaxRate(<span class="hljs-number">20.0</span>);

<span class="hljs-variable">$item2</span> = <span class="hljs-keyword">new</span> Item(<span class="hljs-string">'Item 2'</span>, <span class="hljs-keyword">new</span> Amount(<span class="hljs-number">5</span>, <span class="hljs-string">'EUR'</span>), <span class="hljs-number">2</span>);
<span class="hljs-variable">$item2</span>-&gt;setArticleNumber(<span class="hljs-string">'B2'</span>);
<span class="hljs-variable">$item2</span>-&gt;setDescription(<span class="hljs-string">'My second item'</span>);
<span class="hljs-variable">$item2</span>-&gt;setTaxRate(<span class="hljs-number">10.0</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The items are all stored in a <code>Basket</code> object.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$basket</span> = <span class="hljs-keyword">new</span> Basket();
<span class="hljs-variable">$basket</span>-&gt;add(<span class="hljs-variable">$item1</span>);
<span class="hljs-variable">$basket</span>-&gt;add(<span class="hljs-variable">$item2</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The amount needs to be equal to the total amount for the order items.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$amount</span> = <span class="hljs-keyword">new</span> Amount(<span class="hljs-number">12.59</span>, <span class="hljs-string">'EUR'</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h3 id="transaction">Transaction</h3></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The PayPal transaction holds all transaction relevant data for the reserve process.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$transaction</span> = <span class="hljs-keyword">new</span> PayPalTransaction();
<span class="hljs-variable">$transaction</span>-&gt;setNotificationUrl(<span class="hljs-variable">$notificationUrl</span>);
<span class="hljs-variable">$transaction</span>-&gt;setRedirect(<span class="hljs-variable">$redirectUrls</span>);
<span class="hljs-variable">$transaction</span>-&gt;setAmount(<span class="hljs-variable">$amount</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Include the basket in the transaction.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$transaction</span>-&gt;setBasket(<span class="hljs-variable">$basket</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h3 id="transaction-service">Transaction Service</h3></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The service is used to execute the reserve operation itself. A response object is returned.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$transactionService</span> = <span class="hljs-keyword">new</span> TransactionService(<span class="hljs-variable">$config</span>);
<span class="hljs-variable">$response</span> = <span class="hljs-variable">$transactionService</span>-&gt;reserve(<span class="hljs-variable">$transaction</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="response-handling">Response handling</h2></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The response of the service must be handled depending on it&#39;s class
In case of an <code>InteractionResponse</code>, a browser interaction by the consumer is required
in order to continue the reserve process. In this example we proceed with a header redirect
to the given <em>redirectUrl</em>. IFrame integration using this URL is also possible.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">if</span> (<span class="hljs-variable">$response</span> <span class="hljs-keyword">instanceof</span> InteractionResponse) {
    <span class="hljs-keyword">die</span>(<span class="hljs-string">"&lt;meta http-equiv='refresh' content='0;url={$response-&gt;getRedirectUrl()}'&gt;"</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The failure state is represented by a FailureResponse object.
In this case the returned errors should be stored in your system.</p></div></div><div class="code"><div class="wrapper">} <span class="hljs-keyword">elseif</span> (<span class="hljs-variable">$response</span> <span class="hljs-keyword">instanceof</span> FailureResponse) {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>In our example we iterate over all errors and echo them out. You should display them as
error, warning or information based on the given severity.</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$response</span>-&gt;getStatusCollection() <span class="hljs-keyword">as</span> <span class="hljs-variable">$status</span>) {
        <span class="hljs-comment">/**
         * <span class="hljs-doctag">@var</span> $status \Wirecard\PaymentSdk\Entity\Status
         */</span>
        <span class="hljs-variable">$severity</span> = ucfirst(<span class="hljs-variable">$status</span>-&gt;getSeverity());
        <span class="hljs-variable">$code</span> = <span class="hljs-variable">$status</span>-&gt;getCode();
        <span class="hljs-variable">$description</span> = <span class="hljs-variable">$status</span>-&gt;getDescription();
        <span class="hljs-keyword">echo</span> sprintf(<span class="hljs-string">'%s with code %s and message "%s" occurred.&lt;br&gt;'</span>, <span class="hljs-variable">$severity</span>, <span class="hljs-variable">$code</span>, <span class="hljs-variable">$description</span>);
    }
}

<span class="hljs-keyword">require</span> <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">'/../footer.php'</span>;</div></div></div></div></body></html>