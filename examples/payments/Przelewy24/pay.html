<!DOCTYPE html><html lang="en"><head><title>examples/payments/Przelewy24/pay</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../../"><meta name="groc-document-path" content="examples/payments/Przelewy24/pay"><meta name="groc-project-path" content="examples/payments/Przelewy24/pay.php"><link rel="stylesheet" type="text/css" media="all" href="../../../assets/style.css"><script type="text/javascript" src="../../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">examples/payments/Przelewy24/pay.php</div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-preprocessor">&lt;?php</span>
<span class="hljs-comment">/**
 * Shop System SDK:
 * - Terms of Use can be found under:
 * https://github.com/wirecard/paymentSDK-php/blob/master/_TERMS_OF_USE
 * - License can be found under:
 * https://github.com/wirecard/paymentSDK-php/blob/master/LICENSE
 */</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h1 id="purchase-for-przelewy24">Purchase for Przelewy24</h1></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>To reserve and capture an amount for a credit card</p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="required-objects">Required objects</h2></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>To include the necessary files, we use the composer for PSR-4 autoloading.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">require</span> <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">'/../../../vendor/autoload.php'</span>;
<span class="hljs-keyword">require</span> <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">'/../../inc/common.php'</span>;
<span class="hljs-keyword">require</span> <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">'/../../configuration/globalconfig.php'</span>;

<span class="hljs-keyword">require</span> <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">'/../../inc/header.php'</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Wirecard</span>\<span class="hljs-title">PaymentSdk</span>\<span class="hljs-title">Entity</span>\<span class="hljs-title">Amount</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Wirecard</span>\<span class="hljs-title">PaymentSdk</span>\<span class="hljs-title">Entity</span>\<span class="hljs-title">AccountHolder</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Wirecard</span>\<span class="hljs-title">PaymentSdk</span>\<span class="hljs-title">Entity</span>\<span class="hljs-title">Redirect</span> ;
<span class="hljs-keyword">use</span> <span class="hljs-title">Wirecard</span>\<span class="hljs-title">PaymentSdk</span>\<span class="hljs-title">Response</span>\<span class="hljs-title">FailureResponse</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Wirecard</span>\<span class="hljs-title">PaymentSdk</span>\<span class="hljs-title">Response</span>\<span class="hljs-title">InteractionResponse</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Wirecard</span>\<span class="hljs-title">PaymentSdk</span>\<span class="hljs-title">Transaction</span>\<span class="hljs-title">PtwentyfourTransaction</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Wirecard</span>\<span class="hljs-title">PaymentSdk</span>\<span class="hljs-title">TransactionService</span>;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h3 id="transaction-related-objects">Transaction related objects</h3></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Create an amount object as amount which has to be paid by the consumer.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$amount</span> = <span class="hljs-keyword">new</span> Amount(<span class="hljs-number">12.59</span>, <span class="hljs-string">'PLN'</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Crate an account holder object as it is a mandatory field for Przelewy24</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$accountHolder</span> = <span class="hljs-keyword">new</span> AccountHolder();</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The account holder last name is required for credit.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$accountHolder</span>-&gt;setLastName(<span class="hljs-string">'Cavalera'</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The account holders first name and email are optional.
For complete list of all fields please visit <a href="https://doc.wirecard.com/RestApi_Fields.html">https://doc.wirecard.com/RestApi_Fields.html</a></p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$accountHolder</span>-&gt;setFirstName(<span class="hljs-string">'Max'</span>);
<span class="hljs-variable">$accountHolder</span>-&gt;setEmail(<span class="hljs-string">'max.cavalera@email.com'</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Set redirect URLs for success, cancel and failure.
From payment page you will be redirected to:
Success URL when the payment is approved.
Cancel URL when the user cancels the transaction on payment page.
Failure URL when payment is not approved or the data are missing or incorrect</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$redirectUrls</span> = <span class="hljs-keyword">new</span> Redirect(
    getUrl(<span class="hljs-string">'return.php?status=success'</span>),
    getUrl(<span class="hljs-string">'return.php?status=failure'</span>),
    getUrl(<span class="hljs-string">'return.php?status=failure'</span>)
);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>As soon as the transaction status changes, a server-to-server notification will get delivered to this URL.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$notificationUrl</span> = getUrl(<span class="hljs-string">'notify.php'</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h3 id="transaction">Transaction</h3></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The Przelewy24 transaction contains all relevant data for the payment process.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$transaction</span> = <span class="hljs-keyword">new</span> PtwentyfourTransaction();
<span class="hljs-variable">$transaction</span>-&gt;setAmount(<span class="hljs-variable">$amount</span>);
<span class="hljs-variable">$transaction</span>-&gt;setRedirect(<span class="hljs-variable">$redirectUrls</span>);
<span class="hljs-variable">$transaction</span>-&gt;setNotificationUrl(<span class="hljs-variable">$notificationUrl</span>);
<span class="hljs-variable">$transaction</span>-&gt;setAccountHolder(<span class="hljs-variable">$accountHolder</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h3 id="transaction-service">Transaction Service</h3></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The service is used to execute the payment (authorization + capture) operation itself.
A response object is returned.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$transactionService</span> = <span class="hljs-keyword">new</span> TransactionService(<span class="hljs-variable">$config</span>);
<span class="hljs-variable">$response</span> = <span class="hljs-variable">$transactionService</span>-&gt;pay(<span class="hljs-variable">$transaction</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="response-handling">Response handling</h2></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The response from the service can be used for disambiguation.
Response is not final state of payment, waiting for notification</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">if</span> (<span class="hljs-variable">$response</span> <span class="hljs-keyword">instanceof</span> InteractionResponse):
    <span class="hljs-keyword">die</span>(<span class="hljs-string">"&lt;meta http-equiv='refresh' content='0;url={$response-&gt;getRedirectUrl()}'&gt;"</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>In case of a failed transaction, a <code>FailureResponse</code> object is returned.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">elseif</span> (<span class="hljs-variable">$response</span> <span class="hljs-keyword">instanceof</span> FailureResponse):</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>In our example we iterate over all errors and display them in a raw state.
You should handle them based on the given severity as error, warning or information.</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$response</span>-&gt;getStatusCollection() <span class="hljs-keyword">as</span> <span class="hljs-variable">$status</span>) {
        <span class="hljs-comment">/**
         * <span class="hljs-doctag">@var</span> $status \Wirecard\PaymentSdk\Entity\Status
         */</span>
        <span class="hljs-variable">$severity</span> = ucfirst(<span class="hljs-variable">$status</span>-&gt;getSeverity());
        <span class="hljs-variable">$code</span> = <span class="hljs-variable">$status</span>-&gt;getCode();
        <span class="hljs-variable">$description</span> = <span class="hljs-variable">$status</span>-&gt;getDescription();
        <span class="hljs-keyword">echo</span> sprintf(<span class="hljs-string">'%s with code %s and message "%s" occurred.&lt;br&gt;'</span>, <span class="hljs-variable">$severity</span>, <span class="hljs-variable">$code</span>, <span class="hljs-variable">$description</span>);
    }
<span class="hljs-keyword">endif</span>;

<span class="hljs-keyword">require</span> <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">'/../../inc/footer.php'</span>;</div></div></div></div></body></html>