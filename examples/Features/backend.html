<!DOCTYPE html><html lang="en"><head><title>examples/Features/backend</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../"><meta name="groc-document-path" content="examples/Features/backend"><meta name="groc-project-path" content="examples/Features/backend.php"><link rel="stylesheet" type="text/css" media="all" href="../../assets/style.css"><script type="text/javascript" src="../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">examples/Features/backend.php</div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-preprocessor">&lt;?php</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h1 id="backend-service">Backend Service</h1></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>This example displays the usage of backend service. The service can be used to get all possible follow up operations on an transaction, check if the transaction is an &quot;final&quot; transaction, where no follow up operations are possible, or get the correct order state depending on the transaction type. The backend service also provides a process method where a fallback for refund is build in, if an cancel operation fails the SDK will automatically try to make an refund operation if the payment method supports it.</p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="required-objects">Required objects</h2></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>To include the necessary files, we use the composer for PSR-4 autoloading.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">require</span> <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">'/../../vendor/autoload.php'</span>;
<span class="hljs-keyword">require</span> <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">'/../inc/common.php'</span>;
<span class="hljs-keyword">require</span> <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">'/../inc/config.php'</span>;
<span class="hljs-keyword">require</span> <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">'/../inc/header.php'</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Wirecard</span>\<span class="hljs-title">PaymentSdk</span>\<span class="hljs-title">Transaction</span>\<span class="hljs-title">IdealTransaction</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Wirecard</span>\<span class="hljs-title">PaymentSdk</span>\<span class="hljs-title">BackendService</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Wirecard</span>\<span class="hljs-title">PaymentSdk</span>\<span class="hljs-title">Transaction</span>\<span class="hljs-title">Transaction</span>;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h3 id="transaction">Transaction</h3></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>To get the possible backend operation you need a transaction.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$transaction</span> = <span class="hljs-keyword">new</span> IdealTransaction();</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Parent transaction needs to be set.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-variable">$transaction</span>-&gt;setParentTransactionId(<span class="hljs-string">'02e0a411-44ce-4a41-bd90-062eb586d164'</span>);

<span class="hljs-variable">$backendService</span> = <span class="hljs-keyword">new</span> BackendService(<span class="hljs-variable">$config</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h3 id="backend-operations">Backend operations</h3></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Get all possible backend operations on the transaction, it is possible to set the limit parameter to true for plugin operations only or leave it default to get all possible operations.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">echo</span> <span class="hljs-string">"Possible backend operations: "</span>. print_r(<span class="hljs-variable">$backendService</span>-&gt;retrieveBackendOperations(<span class="hljs-variable">$transaction</span>), <span class="hljs-keyword">true</span>)
    . <span class="hljs-string">"&lt;br/&gt;"</span>;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h3 id="final-status">Final status</h3></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Check if the transaction type is final, if so true is returned.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">echo</span> <span class="hljs-string">"For transaction type debit &lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-string">"Is the transaction final: "</span> . printf(<span class="hljs-variable">$backendService</span>-&gt;isFinal(Transaction::TYPE_DEBIT)) . <span class="hljs-string">"&lt;br/&gt;"</span>;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h3 id="order-state">Order state</h3></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>We can also get the correct order state depending on the transaction type from the service authorized, cancelled, processing or refunded are possible.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">echo</span> <span class="hljs-string">"Order state: "</span> . <span class="hljs-variable">$backendService</span>-&gt;getOrderState(Transaction::TYPE_DEBIT);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h4 id="backend-process">Backend process</h4></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>It is also possible to process orders over the backend service where the fallback for refund is build in. If an cancel transaction fails the sdk will try to do a refund</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">try</span> {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>This is only a example of the use, for testing you need to provide a real transaction otherwise it will fail</p></div></div><div class="code"><div class="wrapper">	<span class="hljs-variable">$backendService</span>-&gt;process(<span class="hljs-variable">$transaction</span>, \Wirecard\PaymentSdk\Transaction\Operation::CANCEL);
} <span class="hljs-keyword">catch</span> (<span class="hljs-keyword">Exception</span> <span class="hljs-variable">$exception</span>) {
	<span class="hljs-keyword">die</span>();
}</div></div></div></div></body></html>